<!DOCTYPE html>
<html lang="en">

    <head>

        <title>PANIC Engine</title>

		<meta charset="UTF-8">

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="icon" type="image/png" href="../logo.png"/>

        <style>

            html, body {

                width: 100%;
                height: 100%;

                margin: 0;

				overflow: hidden;

            }

			#PANIC {

				width: 100%;
				height: 100%;

			}

			#PANIC-Rendering {

				width: 100%;
				height: 100%;

			}

        </style>

    </head>

    <body>

		<script src="../build/panic.js"></script>

        <script>

			// PANIC.Debug.enable();

			// PANIC.Debug.Access.enable();

			let Fish = null;

			try {

				// Add 'await' if seeking complete loading prior to rendering

				PANIC.Loaders.Entity.load( "./presets/entities/minecraft/minecraft.json" );
				PANIC.Loaders.Entity.load( "./presets/entities/minecraft/slim.json" );

				PANIC.Loaders.Entity.load( "./presets/entities/player/player.json" ).then( ( template ) => {

                    Player = PANIC.EntityRegistry.spawnEntity( template.id )

					PANIC.Updater.add( Player );

                    PANIC.Keyboard.onKey( "W", () => {
                        Player.position.x -= 0.0625 * Math.sin( Player.rotation.y );
                        Player.position.z -= 0.0625 * Math.cos( Player.rotation.y );
                    } );
					PANIC.Keyboard.onKey( "S", () => {
                        Player.position.x += 0.0625 * Math.sin( Player.rotation.y );
                        Player.position.z += 0.0625 * Math.cos( Player.rotation.y );
                    } );

					PANIC.Keyboard.onKey( "A", () => { Player.rotation.y += 0.0625; } );
					PANIC.Keyboard.onKey( "D", () => { Player.rotation.y -= 0.0625; } );

                    PANIC.Keyboard.onKey( "SPACE", () => { Player.position.y += 0.0625 * 0.5; } );
                    PANIC.Keyboard.onKey( "SHIFT", () => { Player.position.y -= 0.0625 * 0.5; } );

                });

				PANIC.Loaders.Entity.load( "./presets/entities/debug/debug.json" );

				PANIC.Loaders.Entity.load( "./presets/entities/fish/fish.json" ).then( ( template ) => {

					Fish = PANIC.EntityRegistry.spawnEntity( template.id );

					PANIC.Updater.add( Fish );

                    PANIC.Mouse.onButton( "R", () => { Fish.rotation.y += 0.0625; } );
                    PANIC.Mouse.onButton( "L", () => { Fish.rotation.y -= 0.0625; } );

					PANIC.Mouse.onMove( ( e ) => {
                        Fish.position.x = ( e.x - PANIC.Element.clientWidth / 2 ) / -1000 * Fish.scale.x;
                        Fish.position.z = ( e.y - PANIC.Element.clientHeight / 2 ) / -1000 * Fish.scale.x;
                    } );

                    PANIC.Mouse.onScroll( ( e ) => { Fish.scale.addScalar( e.direction / 4 ); } );

				} );

				PANIC.Debug.Grid.toggle();
				PANIC.Debug.Grid.scale = 16;
				PANIC.Debug.Grid.subdivisions = 16;
				PANIC.Debug.Grid.color = 0x888888;

				PANIC.Debug.Axes.toggle();

				PANIC.Debug.Compass.toggle();

				let Loop = function( time=0 ) {

				    PANIC.Renderer.render( PANIC.Scene, PANIC.Camera );

					PANIC.Updater.update();

                    // console.log( PANIC.Mouse.getPosition() )

				    requestAnimationFrame( Loop );

				}

				requestAnimationFrame( Loop );

			}

			catch( error ) {

				PANIC.Debug.error( error );

			}

        </script>

    </body>

</html>
